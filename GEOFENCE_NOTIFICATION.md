# ジオフェンス通知機能

## 概要
位置情報を監視して、指定したジオフェンスの中に入っているかどうかを判定し、入っていたら利用者にメッセージを送る機能を実装しました。

## 実装内容

### 1. アプリ内通知サービス
`src/services/NotificationService.jsx` と `src/services/NotificationService.css` を作成し、アプリ内通知機能を実装しました。

#### 主な機能
- `sendNotification(title, message)`: 通知を送信する関数
- `AppNotification`: 通知を表示するReactコンポーネント
  - 通知はスライドインアニメーションで表示され、5秒後に自動的にフェードアウト
  - 複数の通知を同時に表示可能

### 2. ジオフェンス監視機能の拡張
`src/Geofence.jsx` を拡張して、ジオフェンスの状態変化を検出し、通知を送る機能を追加しました。

#### 主な機能
- 前回のジオフェンス状態を保存し、新しく入ったジオフェンスを検出
- 新しく入ったジオフェンスがある場合、通知を送信
- 通知のON/OFF設定
- ジオフェンスごとのカスタムメッセージ設定

### 3. 通知設定UI
ジオフェンス状態パネルに通知設定UIを追加しました。

#### 主な機能
- 通知のON/OFFを切り替えるチェックボックス
- ジオフェンスごとにカスタムメッセージを設定できる入力フィールド

## 技術的な詳細

### データフロー
1. 位置情報が更新される
2. ジオフェンス評価関数が実行される
3. 新しく入ったジオフェンスを検出
4. 通知が有効な場合、通知を送信
5. 通知イベントがAppNotificationコンポーネントで捕捉される
6. 通知が画面に表示される

### 通知の仕組み
- カスタムイベント `app-notification` を使用して、コンポーネント間で通知情報を伝達
- Reactの `useState` と `useEffect` を使用して通知の表示と削除を管理
- CSSアニメーションを使用して、通知のスライドインとフェードアウト効果を実現

## 使用方法

1. 「ジオフェンス表示」ボタンをクリックして、ジオフェンス状態パネルを表示
2. 「ジオフェンス通知を有効にする」チェックボックスがオンになっていることを確認
3. 必要に応じて、各ジオフェンスのカスタムメッセージを設定
4. 「現在位置を取得」または「位置情報を監視」ボタンをクリックして位置情報の取得を開始
5. ジオフェンスに入ると、画面右上に通知が表示される

## 今後の改善点

1. 通知履歴の表示機能
2. 通知音の追加
3. ジオフェンスから出た時の通知機能
4. 通知の表示時間をカスタマイズする機能
5. プッシュ通知との連携（PWA対応）
